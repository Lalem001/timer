!function(a){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],a):"object"==typeof exports?module.exports=a(require("underscore"),require("backbone")):window.Timer=a(window._,window.Backbone)}(function(a,b){"use strict";var c;return c=function(b,c){if(a.isUndefined(b)||!a.isNumber(b))throw new TypeError("Timer: Scheduled duration is required and must be a number");if(a.isUndefined(c)||!a.isNumber(c))throw new TypeError("Timer: Max duration is required and must be a number");if(b>c)throw new Error("Scheduled duration should be less than the max duration.");return this._pausedDuration=0,this._scheduledDuration=b,this._maxDuration=c,this._isStarted=!1,this._isPaused=!1,this},a.extend(c.prototype,b.Events,{start:function(){if(this._isStarted)return!1;var a=this;return this.scheduledTimer=this.setTimeout(function(){return a.emitCompleted()},this._scheduledDuration),this.timedOutTimer=this.setTimeout(function(){return a.stop(),a.emitTimeOut()},this._maxDuration),this._isStarted=!0,this._startTime=Date.now(),this._stopTime=void 0,!0},stop:function(){return this._isStarted?(this.scheduledTimer.clear(),this.timedOutTimer.clear(),this._isStarted=!1,this._isPaused=!1,this._stopTime=Date.now(),!0):!1},pause:function(){return!this._isStarted||this._isPaused?!1:(this._isPaused=!0,this.scheduledTimer.clear(),this._pausedTime=Date.now(),!0)},resume:function(){if(!this._isStarted||!this._isPaused)return!1;this._isPaused=!1,this._pausedDuration+=Date.now()-this._pausedTime,this._pausedTime=void 0;var a=this,b=this._scheduledDuration-this.scheduledTimer.elapsed();return this.scheduledTimer=this.setTimeout(function(){return a.emitCompleted()},b),!0},extend:function(a){if(!this._isStarted)return!1;if(this._isPaused)return this._scheduledDuration+a>this._maxDuration?this._scheduledDuration=this._maxDuration:this._scheduledDuration+=a,!0;this.scheduledTimer.clear();var b=this,c=this.scheduledTimer.elapsed();return this._scheduledDuration+a>this._maxDuration?(a=this._maxDuration-c,this._scheduledDuration=this._maxDuration):(this._scheduledDuration+=a,a=this._scheduledDuration-c),this.scheduledTimer=this.setTimeout(function(){return b.emitCompleted()},a),!0},emitCompleted:function(){return this.trigger("completed"),!1},emitTimeOut:function(){return this.trigger("timedout"),!1},setTimeout:function(b,c){if(!a.isFunction(b)||!a.isNumber(c))return void 0;var d,e,f,g={},h=Date.now(),i=Math.min(Math.ceil(c/10),1e3),j=!1;return e=function(){if(!j){var a=Math.min(i,c+h-Date.now());0>=a?(d=Date.now(),b.call(this)):f=setTimeout(e,a)}},e(),g.elapsed=function(){return d?d-h:-h+Date.now()},g.clear=function(){return clearTimeout(f),d=Date.now(),j=!0,!0},g},elapsed:function(){return this.timedOutTimer.elapsed()}}),c});